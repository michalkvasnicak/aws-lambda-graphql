<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1339px" preserveAspectRatio="none" style="width:1351px;height:1339px;" version="1.1" viewBox="0 0 1351 1339" width="1351px" zoomAndPan="magnify"><defs><filter height="300%" id="f1unc907lp5wta" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="622.75" y="23.5352">How it works</text><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="117.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="448" y="191.5977"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="764.7637" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="448" y="381.4609"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="236.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="453" y="659.2559"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="58.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="220.9082"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="410.7715"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="177.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="688.5664"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="949.3613"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="250.2188"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="440.082"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="498.7031"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="717.877"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="978.6719"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="75.9316" style="stroke: #000000; stroke-width: 2.0;" width="512.5" x="817" y="762.1875"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="1316.5" x="13" y="910.7402"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="46" x2="46" y1="116.9766" y2="1252.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="452.5" x2="452.5" y1="116.9766" y2="1252.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="889" x2="889" y1="116.9766" y2="1252.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1289.5" x2="1289.5" y1="116.9766" y2="1252.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="23" y="114.0234">Client</text><ellipse cx="46" cy="43.4883" fill="#FEFECE" filter="url(#f1unc907lp5wta)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M46,51.4883 L46,78.4883 M33,59.4883 L59,59.4883 M46,78.4883 L33,93.4883 M46,78.4883 L59,93.4883 " fill="none" filter="url(#f1unc907lp5wta)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="23" y="1264.6914">Client</text><ellipse cx="46" cy="1277.6445" fill="#FEFECE" filter="url(#f1unc907lp5wta)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M46,1285.6445 L46,1312.6445 M33,1293.6445 L59,1293.6445 M46,1312.6445 L33,1327.6445 M46,1312.6445 L59,1327.6445 " fill="none" filter="url(#f1unc907lp5wta)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="380.5" y="114.0234">AWS API Gateway V2</text><path d="M432.5,72.4883 L432.5,96.4883 M432.5,84.4883 L449.5,84.4883 " fill="none" filter="url(#f1unc907lp5wta)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="461.5" cy="84.4883" fill="#FEFECE" filter="url(#f1unc907lp5wta)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="380.5" y="1264.6914">AWS API Gateway V2</text><path d="M432.5,1271.6445 L432.5,1295.6445 M432.5,1283.6445 L449.5,1283.6445 " fill="none" filter="url(#f1unc907lp5wta)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="461.5" cy="1283.6445" fill="#FEFECE" filter="url(#f1unc907lp5wta)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1unc907lp5wta)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="827" y="81.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="834" y="102.0234">GraphQL server</text><rect fill="#FEFECE" filter="url(#f1unc907lp5wta)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="827" y="1251.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="834" y="1271.6914">GraphQL server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="1260.5" y="114.0234">Storage</text><path d="M1272,64.4883 C1272,54.4883 1290,54.4883 1290,54.4883 C1290,54.4883 1308,54.4883 1308,64.4883 L1308,90.4883 C1308,100.4883 1290,100.4883 1290,100.4883 C1290,100.4883 1272,100.4883 1272,90.4883 L1272,64.4883 " fill="#FEFECE" filter="url(#f1unc907lp5wta)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1272,64.4883 C1272,74.4883 1290,74.4883 1290,74.4883 C1290,74.4883 1308,74.4883 1308,64.4883 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="1260.5" y="1264.6914">Storage</text><path d="M1272,1277.6445 C1272,1267.6445 1290,1267.6445 1290,1267.6445 C1290,1267.6445 1308,1267.6445 1308,1277.6445 L1308,1303.6445 C1308,1313.6445 1290,1313.6445 1290,1313.6445 C1290,1313.6445 1272,1313.6445 1272,1303.6445 L1272,1277.6445 " fill="#FEFECE" filter="url(#f1unc907lp5wta)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1272,1277.6445 C1272,1287.6445 1290,1287.6445 1290,1287.6445 C1290,1287.6445 1308,1287.6445 1308,1277.6445 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="117.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="448" y="191.5977"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="764.7637" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="448" y="381.4609"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="236.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="453" y="659.2559"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="58.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="220.9082"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="146.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="410.7715"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="177.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="688.5664"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="87.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="884" y="949.3613"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="250.2188"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="440.082"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="498.7031"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="717.877"/><rect fill="#FFFFFF" filter="url(#f1unc907lp5wta)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1285" y="978.6719"/><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1336.5" x="3" y="147.6318"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="147.6318" y2="147.6318"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="150.6318" y2="150.6318"/><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="71" x="635.75" y="136.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="53" x="641.75" y="153.5449">connect</text><polygon fill="#A80036" points="436,187.5977,446,191.5977,436,195.5977,440,191.5977" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="442" y1="191.5977" y2="191.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="53" y="186.8555">connect</text><polygon fill="#A80036" points="872,216.9082,882,220.9082,872,224.9082,876,220.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="458" x2="878" y1="220.9082" y2="220.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="465" y="216.166">send event with $connect routeKey serveWebSocket handler</text><polygon fill="#A80036" points="1273,246.2188,1283,250.2188,1273,254.2188,1277,250.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="894" x2="1279" y1="250.2188" y2="250.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="901" y="245.4766">register connection (connectionId)</text><polygon fill="#A80036" points="900,275.5293,890,279.5293,900,283.5293,896,279.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="894" x2="1289" y1="279.5293" y2="279.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="906" y="274.7871">success</text><polygon fill="#A80036" points="57,304.8398,47,308.8398,57,312.8398,53,308.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51" x2="452" y1="308.8398" y2="308.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="63" y="304.0977">send GQL_CONNECTED message</text><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1336.5" x="3" y="337.4951"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="337.4951" y2="337.4951"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="340.4951" y2="340.4951"/><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="181" x="580.75" y="326.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="586.75" y="343.4082">operation (subscription)</text><polygon fill="#A80036" points="436,377.4609,446,381.4609,436,385.4609,440,381.4609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="442" y1="381.4609" y2="381.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="53" y="376.7188">send GQL_OP message (id, operationName, query, variables)</text><polygon fill="#A80036" points="872,406.7715,882,410.7715,872,414.7715,876,410.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="458" x2="878" y1="410.7715" y2="410.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="387" x="465" y="406.0293">send event with $default routeKey to serveWebSocket handler</text><polygon fill="#A80036" points="1273,436.082,1283,440.082,1273,444.082,1277,440.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="894" x2="1279" y1="440.082" y2="440.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="901" y="435.3398">get registered connection by connectionId</text><polygon fill="#A80036" points="905,465.3926,895,469.3926,905,473.3926,901,469.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="899" x2="1289" y1="469.3926" y2="469.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="911" y="464.6504">registered connection</text><polygon fill="#A80036" points="1273,494.7031,1283,498.7031,1273,502.7031,1277,498.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="894" x2="1279" y1="498.7031" y2="498.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="901" y="493.9609">register subscription</text><polygon fill="#A80036" points="905,524.0137,895,528.0137,905,532.0137,901,528.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="899" x2="1289" y1="528.0137" y2="528.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="911" y="523.2715">subscription registered</text><polygon fill="#A80036" points="469,553.3242,459,557.3242,469,561.3242,465,557.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="463" x2="888" y1="557.3242" y2="557.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="475" y="552.582">send GQL_OP_SUBSCRIBED (id)</text><polygon fill="#A80036" points="57,582.6348,47,586.6348,57,590.6348,53,586.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51" x2="447" y1="586.6348" y2="586.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="63" y="581.8926">send GQL_OP_SUBSCRIBED (id)</text><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1336.5" x="3" y="615.29"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="615.29" y2="615.29"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="618.29" y2="618.29"/><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="205" x="568.75" y="604.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="574.75" y="621.2031">operation (query/mutation)</text><polygon fill="#A80036" points="441,655.2559,451,659.2559,441,663.2559,445,659.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="447" y1="659.2559" y2="659.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="53" y="654.5137">send GQL_OP message (id, operationName, query, variables)</text><polygon fill="#A80036" points="872,684.5664,882,688.5664,872,692.5664,876,688.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="463" x2="878" y1="688.5664" y2="688.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="387" x="470" y="683.8242">send event with $default routeKey to serveWebSocket handler</text><polygon fill="#A80036" points="1273,713.877,1283,717.877,1273,721.877,1277,717.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="894" x2="1279" y1="717.877" y2="717.877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="901" y="713.1348">get registered connection by connectionId</text><polygon fill="#A80036" points="905,743.1875,895,747.1875,905,751.1875,901,747.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="899" x2="1289" y1="747.1875" y2="747.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="911" y="742.4453">registered connection</text><path d="M817,762.1875 L961,762.1875 L961,769.1875 L951,779.1875 L817,779.1875 L817,762.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.9316" style="stroke: #000000; stroke-width: 2.0;" width="512.5" x="817" y="762.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="832" y="775.7559">Publish events</text><polygon fill="#A80036" points="1278,796.8086,1288,800.8086,1278,804.8086,1282,800.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="894" x2="1284" y1="800.8086" y2="800.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="901" y="796.0664">write events</text><polygon fill="#A80036" points="905,826.1191,895,830.1191,905,834.1191,901,830.1191" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="899" x2="1289" y1="830.1191" y2="830.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="911" y="825.377">success</text><polygon fill="#A80036" points="474,862.4297,464,866.4297,474,870.4297,470,866.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="468" x2="888" y1="866.4297" y2="866.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="480" y="861.6875">send GQL_OP_RESULT (id, result)</text><polygon fill="#A80036" points="57,891.7402,47,895.7402,57,899.7402,53,895.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51" x2="447" y1="895.7402" y2="895.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="63" y="890.998">send GQL_OP_RESULT (id, result)</text><path d="M13,910.7402 L337,910.7402 L337,917.7402 L327,927.7402 L13,927.7402 L13,910.7402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.8633" style="stroke: #000000; stroke-width: 2.0;" width="1316.5" x="13" y="910.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="279" x="28" y="924.3086">Process and send events to subscriptions</text><polygon fill="#A80036" points="905,945.3613,895,949.3613,905,953.3613,901,949.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="899" x2="1289" y1="949.3613" y2="949.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="911" y="944.6191">Send events to event processor handler</text><polygon fill="#A80036" points="1273,974.6719,1283,978.6719,1273,982.6719,1277,978.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="894" x2="1279" y1="978.6719" y2="978.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="901" y="973.9297">For each event load all subscriptions that are listening to it</text><polygon fill="#A80036" points="905,1003.9824,895,1007.9824,905,1011.9824,901,1007.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="899" x2="1289" y1="1007.9824" y2="1007.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="911" y="1003.2402">Subscriptions</text><polygon fill="#A80036" points="469,1033.293,459,1037.293,469,1041.293,465,1037.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="463" x2="888" y1="1037.293" y2="1037.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="475" y="1032.5508">Send GQL_OP_RESULT (id, result) to all relevant subscriptions</text><polygon fill="#A80036" points="57,1062.6035,47,1066.6035,57,1070.6035,53,1066.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51" x2="447" y1="1066.6035" y2="1066.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="63" y="1061.8613">Send GQL_OP_RESULT ...</text><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1336.5" x="3" y="1102.2588"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="1102.2588" y2="1102.2588"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1339.5" y1="1105.2588" y2="1105.2588"/><rect fill="#EEEEEE" filter="url(#f1unc907lp5wta)" height="23.3105" style="stroke: #000000; stroke-width: 2.0;" width="91" x="625.75" y="1091.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="631.75" y="1108.1719">disconnect</text><polygon fill="#A80036" points="441,1142.2246,451,1146.2246,441,1150.2246,445,1146.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="447" y1="1146.2246" y2="1146.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="53" y="1141.4824">disconnect</text><polygon fill="#A80036" points="877,1171.5352,887,1175.5352,877,1179.5352,881,1175.5352" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="453" x2="883" y1="1175.5352" y2="1175.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="460" y="1170.793">send event with $disconnect routeKey to serveWebSocket handler</text><polygon fill="#A80036" points="1278,1200.8457,1288,1204.8457,1278,1208.8457,1282,1204.8457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="889" x2="1284" y1="1204.8457" y2="1204.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="896" y="1200.1035">unregister connection (connectionId)</text><polygon fill="#A80036" points="900,1230.1563,890,1234.1563,900,1238.1563,896,1234.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="894" x2="1289" y1="1234.1563" y2="1234.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="906" y="1229.4141">success</text><!--
@startuml

title How it works

actor Client
boundary "AWS API Gateway V2" as AWSAGWS
participant "GraphQL server" as GQL
database Storage

== connect ==
Client -> AWSAGWS: connect
activate AWSAGWS

AWSAGWS -> GQL: send event with $connect routeKey serveWebSocket handler
activate GQL
GQL -> Storage: register connection (connectionId)
activate Storage
Storage - -> GQL: success
deactivate Storage
deactivate GQL

AWSAGWS - -> Client: send GQL_CONNECTED message
deactivate AWSAGWS

== operation (subscription) ==
Client -> AWSAGWS: send GQL_OP message (id, operationName, query, variables)
activate AWSAGWS

AWSAGWS -> GQL: send event with $default routeKey to serveWebSocket handler
activate GQL

GQL - -> Storage: get registered connection by connectionId
activate Storage
Storage - -> GQL: registered connection
deactivate Storage

GQL -> Storage: register subscription
activate Storage
Storage -> GQL: subscription registered
deactivate Storage

GQL - -> AWSAGWS: send GQL_OP_SUBSCRIBED (id)
deactivate GQL

AWSAGWS - -> Client: send GQL_OP_SUBSCRIBED (id)

== operation (query/mutation) ==
Client -> AWSAGWS: send GQL_OP message (id, operationName, query, variables)
activate AWSAGWS

AWSAGWS -> GQL: send event with $default routeKey to serveWebSocket handler
activate GQL

GQL -> Storage: get registered connection by connectionId
activate Storage

Storage - -> GQL: registered connection
deactivate Storage

group Publish events 
GQL -> Storage: write events
Storage - -> GQL: success
end

GQL - -> AWSAGWS: send GQL_OP_RESULT (id, result)
deactivate GQL
AWSAGWS - -> Client: send GQL_OP_RESULT (id, result)
deactivate AWSAGWS

group Process and send events to subscriptions
Storage -> GQL: Send events to event processor handler
activate GQL
GQL -> Storage: For each event load all subscriptions that are listening to it
activate Storage
Storage - -> GQL: Subscriptions
deactivate Storage
GQL -> AWSAGWS: Send GQL_OP_RESULT (id, result) to all relevant subscriptions
deactivate GQL
AWSAGWS -> Client: Send GQL_OP_RESULT ...
end

== disconnect ==
Client -> AWSAGWS: disconnect
deactivate AWSAGWS
AWSAGWS -> GQL: send event with $disconnect routeKey to serveWebSocket handler
GQL -> Storage: unregister connection (connectionId)
Storage - -> GQL: success

@enduml

PlantUML version 1.2018.12(Sun Oct 21 12:15:15 CEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_60-b27
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: US-ASCII
Language: en
Country: US
--></g></svg>